/**
 * Copyright 2025 Blackout Secure
 * SPDX-License-Identifier: Apache-2.0
 *
 * Output formatting utilities for console logging
 */

const {
  getCopyrightNotice,
  getProjectTitle,
  getRepositoryUrl,
  getSupportUrl,
} = require('./project-config');

const DIVIDER = '‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ';

/**
 * Print application header
 * @param {object} core - GitHub Actions core module
 */
function printHeader(core) {
  core.info(DIVIDER);
  core.info(getProjectTitle());
  core.info(DIVIDER);
  core.info(getCopyrightNotice());
  core.info(getRepositoryUrl());
  core.info(getSupportUrl());
  core.info(DIVIDER);
}

/**
 * Print application footer
 * @param {object} core - GitHub Actions core module
 * @param {string} [sponsorName] - Optional sponsor/company name to display
 */
function printFooter(core, sponsorName) {
  if (sponsorName) {
    core.info(`\n‚ú® Sitemap generated by ${sponsorName}`);
  }

  core.info(DIVIDER);
  core.info('‚úÖ Sitemap generation complete!');
  core.info(DIVIDER);
  core.info(getCopyrightNotice());
  core.info(getRepositoryUrl());
  core.info(DIVIDER);
}

/**
 * Print section header
 * @param {object} core - GitHub Actions core module
 * @param {string} emoji - Section emoji
 * @param {string} title - Section title
 * @param {string} status - Status: 'Enabled', 'Disabled', or custom
 */
function printSectionHeader(core, emoji, title, status = null) {
  core.info('');
  if (status) {
    core.info(`${emoji} ${title}: ${status}`);
  } else {
    core.info(`${emoji} ${title}:`);
  }
}

/**
 * Print section start message
 * @param {object} core - GitHub Actions core module
 * @param {string} message - Start message
 */
function printSectionStart(core, message) {
  core.info(`   üöÄ ${message}`);
}

/**
 * Print section success message
 * @param {object} core - GitHub Actions core module
 * @param {string} message - Success message
 */
function printSectionSuccess(core, message) {
  core.info(`   ‚úÖ ${message}`);
}

/**
 * Print configuration summary header
 * @param {object} core - GitHub Actions core module
 */
function printConfigHeader(core) {
  core.info(`\n${DIVIDER}`);
  core.info('‚öôÔ∏è  Configuration Summary');
  core.info(DIVIDER);
}

/**
 * Print configuration section
 * @param {object} core - GitHub Actions core module
 * @param {string} emoji - Section emoji
 * @param {string} title - Section title
 * @param {object} items - Configuration items as key-value pairs
 */
function printConfigSection(core, emoji, title, items) {
  core.info(`\n${emoji} ${title}:`);
  for (const [key, value] of Object.entries(items)) {
    core.info(`   ${key.padEnd(20)} ${value}`);
  }
}

/**
 * Print sitemap generation section
 * @param {object} core - GitHub Actions core module
 * @param {object} config - Sitemap configuration
 * @param {object} _results - Generation results (reserved for future use)
 */
function printSitemapSection(core, config, _results) {
  if (!config.generateXmlSitemap && !config.generateTxtSitemap) {
    printSectionHeader(core, 'üìù', 'Sitemap Generation', 'Disabled');
    return;
  }

  printSectionHeader(core, 'üìù', 'Sitemap Generation');

  // Configuration
  core.info('   üìã Configuration:');
  core.info(`      XML Sitemap:         ${config.generateXmlSitemap ? 'Enabled' : 'Disabled'}`);
  core.info(`      TXT Sitemap:         ${config.generateTxtSitemap ? 'Enabled' : 'Disabled'}`);
  core.info(
    `      Gzip Compression:    ${config.generateGzip ? 'Enabled (XML only)' : 'Disabled'}`
  );
  core.info(`      Last Modified:       ${config.lastmodStrategy}`);
  core.info(`      Change Frequency:    ${config.changefreq || '(not set)'}`);
  core.info(`      Priority:            ${config.priority || '(not set)'}`);

  // Execution
  core.info('');
  printSectionStart(core, 'Starting sitemap generation...');

  // Results will be printed by the generation logic
}

/**
 * Print sitemap validation results
 * @param {object} core - GitHub Actions core module
 * @param {object} results - Validation results
 * @param {boolean} _strict - Strict validation mode (reserved for future use)
 */
function printSitemapValidation(core, results, _strict) {
  core.info('   üîç Validation:');

  if (results.xmlSitemap) {
    core.info(`      ‚úì Valid XML format`);
    core.info(`      ‚úì Size OK (${results.xmlSitemap.size})`);
    if (results.xmlSitemap.gzipSize) {
      core.info(`      ‚úì Gzip size OK (${results.xmlSitemap.gzipSize})`);
    }
  }

  if (results.txtSitemap) {
    core.info(`      ‚úì Valid TXT format`);
    core.info(`      ‚úì Size OK (${results.txtSitemap.size})`);
  }
}

/**
 * Print robots.txt section
 * @param {object} core - GitHub Actions core module
 * @param {object} config - Robots.txt configuration
 * @param {object} _results - Generation results (reserved for future use)
 */
function printRobotsSection(core, config, _results) {
  if (!config.generateRobotsTxt) {
    printSectionHeader(core, 'ü§ñ', 'Robots.txt Generation', 'Disabled');
    return;
  }

  printSectionHeader(core, 'ü§ñ', 'Robots.txt Generation');

  // Configuration
  core.info('   üìã Configuration:');
  core.info(`      User-agent:          ${config.robotsUserAgent}`);
  core.info(
    `      Disallow Paths:      ${config.robotsDisallow.length ? config.robotsDisallow.join(', ') : 'Allow all'}`
  );
  if (config.robotsAllow.length > 0) {
    core.info(`      Allow Paths:         ${config.robotsAllow.join(', ')}`);
  }
  if (config.robotsCrawlDelay) {
    core.info(`      Crawl-delay:         ${config.robotsCrawlDelay} seconds`);
  }

  // Execution
  core.info('');
  printSectionStart(core, 'Generating robots.txt with sitemap references...');

  // Results will be printed by the generation logic
}

/**
 * Print robots.txt validation results
 * @param {object} core - GitHub Actions core module
 * @param {object} results - Validation results
 */
function printRobotsValidation(core, results) {
  core.info('   üîç Validation:');

  if (results.hasSitemap) {
    core.info(`      ‚úì Contains Sitemap reference`);
  }
  core.info(`      ‚úì Size OK (${results.size})`);
  if (results.sitemapCount) {
    core.info(`      ‚úì ${results.sitemapCount} unique sitemap(s) referenced`);
  }
}

/**
 * Print humans.txt section
 * @param {object} core - GitHub Actions core module
 * @param {object} config - Humans.txt configuration
 * @param {object} _results - Generation results (reserved for future use)
 */
function printHumansSection(core, config, _results) {
  if (!config.generateHumansTxt) {
    printSectionHeader(core, 'üë•', 'Humans.txt Generation', 'Disabled');
    return;
  }

  printSectionHeader(core, 'üë•', 'Humans.txt Generation');

  // Configuration
  core.info('   üìã Configuration:');
  const sections = [];
  if (config.hasTeamInfo) sections.push('TEAM');
  if (config.hasThanksInfo) sections.push('THANKS');
  if (config.hasSiteInfo) sections.push('SITE');

  if (sections.length > 0) {
    core.info(`      Sections:            ${sections.join(', ')}`);
  } else {
    core.info(`      Content:             Minimal (no custom fields)`);
  }

  // Execution
  core.info('');
  printSectionStart(core, 'Generating humans.txt with team and site information...');

  // Results will be printed by the generation logic
}

/**
 * Print humans.txt validation results
 * @param {object} core - GitHub Actions core module
 * @param {object} results - Validation results
 */
function printHumansValidation(core, results) {
  core.info('   üîç Validation:');
  core.info(`      ‚úì Size OK (${results.size})`);
  if (results.sections) {
    core.info(`      ‚úì Contains sections: ${results.sections.join(', ')}`);
  }
  core.info(`      ‚úì Valid humans.txt format`);
}

/**
 * Print security.txt section
 * @param {object} core - GitHub Actions core module
 * @param {object} config - Security.txt configuration
 * @param {object} _results - Generation results (reserved for future use)
 */
function printSecuritySection(core, config, _results) {
  if (!config.generateSecurityTxt) {
    printSectionHeader(core, 'üîí', 'Security.txt Generation', 'Disabled');
    return;
  }

  printSectionHeader(core, 'üîí', 'Security.txt Generation');

  // Configuration
  core.info('   üìã Configuration:');
  core.info(`      Contact:             ${config.contactCount} contact(s)`);
  core.info(`      Expires:             ${config.expires}`);
  if (config.optionalFields.length > 0) {
    core.info(`      Optional Fields:     ${config.optionalFields.join(', ')}`);
  }

  // Execution
  core.info('');
  printSectionStart(core, 'Generating security.txt per RFC 9116 standard...');

  // Results will be printed by the generation logic
}

/**
 * Print security.txt validation results
 * @param {object} core - GitHub Actions core module
 * @param {object} results - Validation results
 */
function printSecurityValidation(core, results) {
  core.info('   üîç Validation:');
  core.info(`      ‚úì Size OK (${results.size})`);
  core.info(`      ‚úì Contains Contact field (${results.contactCount} contact(s))`);
  core.info(`      ‚úì Valid Expires field (${results.expires})`);
  if (results.optionalFields.length > 0) {
    core.info(`      ‚úì Optional fields: ${results.optionalFields.join(', ')}`);
  }
  if (!results.signed) {
    core.info(`      ‚ÑπÔ∏è  File is not digitally signed (signing is recommended)`);
  }
  core.info(`      ‚úì Valid security.txt format (RFC 9116)`);
}

/**
 * Print validation section header
 * @param {object} core - GitHub Actions core module
 * @param {boolean} strict - Strict validation mode
 */
function printValidationHeader(core, strict) {
  core.info('');
  core.info('üîç Validation:');
  if (strict) {
    core.info('   Mode: Strict (will fail on errors)');
  } else {
    core.info('   Mode: Standard (warnings only)');
  }
}

module.exports = {
  printHeader,
  printFooter,
  printSectionHeader,
  printSectionStart,
  printSectionSuccess,
  printConfigHeader,
  printConfigSection,
  printSitemapSection,
  printSitemapValidation,
  printRobotsSection,
  printRobotsValidation,
  printHumansSection,
  printHumansValidation,
  printSecuritySection,
  printSecurityValidation,
  printValidationHeader,
};
